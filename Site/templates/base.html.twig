<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8">
        <title>{% block title %}Welcome!{% endblock %}</title>
        <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 128 128%22><text y=%221.2em%22 font-size=%2296%22>⚫️</text><text y=%221.3em%22 x=%220.2em%22 font-size=%2276%22 fill=%22%23fff%22>sf</text></svg>">
        {% block stylesheets %}
            {{ encore_entry_link_tags('app') }}
        {% endblock %}

        {% block javascripts %}
            {{ encore_entry_script_tags('app') }}
            {% block importmap %}{{ importmap('app') }}{% endblock %}
            {% if app.user %}
            <script>
                // Charger les points de l'utilisateur
                fetch('{{ path('user_points') }}')
                    .then(response => response.json())
                    .then(data => {
                        if (data.points !== undefined) {
                            document.getElementById('points-display').textContent = data.points;
                        } else {
                            document.getElementById('points-display').textContent = '0';
                        }
                    })
                    .catch(error => {
                        console.error('Erreur lors du chargement des points:', error);
                        document.getElementById('points-display').textContent = '0';
                    });
            </script>
            {% endif %}
        {% endblock %}
    </head>
    <body>
        <nav style="background: #2563eb; color: white; padding: 1rem;">
            <div style="max-width: 1200px; margin: 0 auto; display: flex; justify-content: space-between; align-items: center;">
                <div style="display: flex; align-items: center; gap: 1.5rem;">
                    <a href="{{ path('app_home') }}" style="font-size: 1.25rem; font-weight: bold; color: white; text-decoration: none;">AlloParents</a>
                    {% if app.user %}
                        <div style="display: flex; gap: 1rem;">
                            <a href="{{ path('trajet_rechercher') }}" style="color: white; text-decoration: none; hover: color: #bfdbfe;">Rechercher des trajets</a>
                            <a href="{{ path('trajet_ajouter') }}" style="color: white; text-decoration: none; hover: color: #bfdbfe;">Créer un trajet</a>
                            <a href="{{ path('trajet_mes_trajets') }}" style="color: white; text-decoration: none; hover: color: #bfdbfe;">Mes trajets</a>
                            <a href="{{ path('mes_reservations') }}" style="color: white; text-decoration: none; hover: color: #bfdbfe;">Mes réservations</a>
                            <a href="{{ path('chat_messages') }}" style="color: white; text-decoration: none; hover: color: #bfdbfe;">Mes messages</a>
            
                            {% if is_granted('ROLE_ADMIN') %}
                                <a href="{{ path('admin_dashboard') }}" style="color: white; text-decoration: none; hover: color: #bfdbfe;">Admin</a>
                            {% endif %}
                        </div>
                    {% endif %}
                </div>
                <div style="display: flex; align-items: center; gap: 1rem;">
                    {% if app.user %}
                        <span style="color: #bfdbfe;">Bonjour {{ app.user.userIdentifier }} !</span>
                        <span id="user-points" style="background: #16a34a; color: white; padding: 0.25rem 0.75rem; border-radius: 4px; font-weight: bold;">
                            <span id="points-display">Chargement...</span> points
                        </span>
                        <a href="{{ path('app_logout') }}" style="background: #1d4ed8; color: white; padding: 0.25rem 0.75rem; border-radius: 4px; text-decoration: none; hover: background: #1e40af;">Déconnexion</a>
                    {% else %}
                        <a href="{{ path('app_login') }}" style="color: white; text-decoration: none; hover: color: #bfdbfe;">Connexion</a>
                        <a href="{{ path('app_register') }}" style="background: #1d4ed8; color: white; padding: 0.25rem 0.75rem; border-radius: 4px; text-decoration: none; hover: background: #1e40af;">Inscription</a>
                    {% endif %}
                </div>
            </div>
        </nav>
        
        <div style="padding-bottom: 80px;">
            {% block body %}{% endblock %}
        </div>
        
        <!-- Bottom Navigation (only if user is logged in) -->
        {% if app.user %}
        <nav style="position: fixed; bottom: 0; left: 0; right: 0; background: rgba(0, 0, 0, 0.9); backdrop-filter: blur(20px); border-top: 1px solid rgba(255, 255, 255, 0.1); z-index: 50;">
            <div style="padding: 0.75rem 1rem;">
                <div style="display: flex; justify-content: space-around; align-items: center;">
                    <!-- Accueil -->
                    <a href="{{ path('app_home') }}" style="display: flex; flex-direction: column; align-items: center; gap: 0.25rem; color: white; text-decoration: none; transition: all 0.3s;">
                        <svg style="width: 1.25rem; height: 1.25rem;" fill="currentColor" viewBox="0 0 24 24">
                            <path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"/>
                        </svg>
                        <span style="font-size: 0.75rem;">Accueil</span>
                    </a>
                    
                    <!-- Rechercher -->
                    <a href="{{ path('trajet_rechercher') }}" style="display: flex; flex-direction: column; align-items: center; gap: 0.25rem; color: #9ca3af; text-decoration: none; transition: all 0.3s;">
                        <svg style="width: 1.25rem; height: 1.25rem;" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/>
                        </svg>
                        <span style="font-size: 0.75rem;">Rechercher</span>
                    </a>
                    
                    <!-- Créer -->
                    <a href="{{ path('trajet_ajouter') }}" style="display: flex; flex-direction: column; align-items: center; gap: 0.25rem; color: #9ca3af; text-decoration: none; transition: all 0.3s;">
                        <svg style="width: 1.25rem; height: 1.25rem;" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/>
                        </svg>
                        <span style="font-size: 0.75rem;">Créer</span>
                    </a>
                    
                    <!-- Messages -->
                    <a href="{{ path('chat_messages') }}" style="display: flex; flex-direction: column; align-items: center; gap: 0.25rem; color: #9ca3af; text-decoration: none; transition: all 0.3s; position: relative;">
                        <svg style="width: 1.25rem; height: 1.25rem;" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"/>
                        </svg>
                        <span style="font-size: 0.75rem;">Messages</span>
                    </a>
                    
                    <!-- Menu Plus -->
                    <button onclick="toggleBottomMenu()" style="display: flex; flex-direction: column; align-items: center; gap: 0.25rem; color: #9ca3af; background: none; border: none; cursor: pointer; transition: all 0.3s;" id="bottomMoreButton">
                        <svg style="width: 1.25rem; height: 1.25rem;" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 5v.01M12 12v.01M12 19v.01M12 6a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2z"/>
                        </svg>
                        <span style="font-size: 0.75rem;">Plus</span>
                    </button>
                </div>
            </div>
        </nav>
        
        <!-- Menu Plus flottant -->
        <div id="bottomMoreMenu" style="position: fixed; bottom: 5rem; right: 1rem; background: rgba(0, 0, 0, 0.9); backdrop-filter: blur(20px); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 1rem; box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1); transform: scale(0); transform-origin: bottom right; transition: all 0.3s; z-index: 40; min-width: 200px;">
            <div style="padding: 1rem;">
                <a href="{{ path('trajet_mes_trajets') }}" style="display: flex; align-items: center; gap: 0.75rem; color: white; text-decoration: none; padding: 0.5rem; border-radius: 0.5rem; transition: all 0.3s; hover: background: rgba(255, 255, 255, 0.1);">
                    <svg style="width: 1.25rem; height: 1.25rem;" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"/>
                    </svg>
                    <span style="font-size: 0.875rem;">Mes trajets</span>
                </a>
                
                <a href="{{ path('mes_reservations') }}" style="display: flex; align-items: center; gap: 0.75rem; color: white; text-decoration: none; padding: 0.5rem; border-radius: 0.5rem; transition: all 0.3s; margin-top: 0.25rem;">
                    <svg style="width: 1.25rem; height: 1.25rem;" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/>
                    </svg>
                    <span style="font-size: 0.875rem;">Mes réservations</span>
                </a>
                
                <a href="{{ path('gestion_enfants') }}" style="display: flex; align-items: center; gap: 0.75rem; color: white; text-decoration: none; padding: 0.5rem; border-radius: 0.5rem; transition: all 0.3s; margin-top: 0.25rem;">
                    <svg style="width: 1.25rem; height: 1.25rem;" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6V4m0 2a2 2 0 100 4m0-4a2 2 0 110 4m-6 8a2 2 0 100-4m0 4a2 2 0 100 4m0-4v2m0-6V4m6 6v10m6-2a2 2 0 100-4m0 4a2 2 0 100 4m0-4v2m0-6V4"/>
                    </svg>
                    <span style="font-size: 0.875rem;">Gestion</span>
                </a>
                

            </div>
        </div>
        
        <script>
            function toggleBottomMenu() {
                const menu = document.getElementById('bottomMoreMenu');
                const button = document.getElementById('bottomMoreButton');
                
                if (menu.style.transform === 'scale(1)') {
                    menu.style.transform = 'scale(0)';
                    button.style.color = '#9ca3af';
                } else {
                    menu.style.transform = 'scale(1)';
                    button.style.color = 'white';
                }
            }
            
            // Close menu when clicking outside
            document.addEventListener('click', function(event) {
                const menu = document.getElementById('bottomMoreMenu');
                const button = document.getElementById('bottomMoreButton');
                
                if (menu && button && !menu.contains(event.target) && !button.contains(event.target)) {
                    menu.style.transform = 'scale(0)';
                    button.style.color = '#9ca3af';
                }
            });
        </script>
        {% endif %}
    </body>
</html>
